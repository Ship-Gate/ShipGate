(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8181:function(e,t,s){Promise.resolve().then(s.bind(s,5387))},5387:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return er}});var a=s(9075),n=s(7265),r=s(4763),o=s(6426),i=s(6662);s(37);var l=s(511),c=s(2341);let d={nodes:[],edges:[],selectedNodeId:null,selectedEdgeId:null,domainName:"MyDomain",domainVersion:"1.0.0",zoom:1,isDirty:!1},p=(0,c.Ue)((e,t)=>({...d,setNodes:t=>e({nodes:t,isDirty:!0}),setEdges:t=>e({edges:t,isDirty:!0}),addNode:t=>e(e=>({nodes:[...e.nodes,t],isDirty:!0})),updateNode:(t,s)=>e(e=>({nodes:e.nodes.map(e=>e.id===t?{...e,data:{...e.data,...s}}:e),isDirty:!0})),removeNode:t=>e(e=>({nodes:e.nodes.filter(e=>e.id!==t),edges:e.edges.filter(e=>e.source!==t&&e.target!==t),selectedNodeId:e.selectedNodeId===t?null:e.selectedNodeId,isDirty:!0})),addEdge:t=>e(e=>({edges:[...e.edges,t],isDirty:!0})),removeEdge:t=>e(e=>({edges:e.edges.filter(e=>e.id!==t),selectedEdgeId:e.selectedEdgeId===t?null:e.selectedEdgeId,isDirty:!0})),selectNode:t=>e({selectedNodeId:t,selectedEdgeId:null}),selectEdge:t=>e({selectedEdgeId:t,selectedNodeId:null}),setDomainInfo:(t,s)=>e({domainName:t,domainVersion:s,isDirty:!0}),setZoom:t=>e({zoom:t}),setDirty:t=>e({isDirty:t}),resetEditor:()=>e(d)})),x=()=>{let e=p(e=>e.nodes),t=p(e=>e.selectedNodeId);return e.find(e=>e.id===t)},h=0,u=()=>"node_".concat(h++);function m(){let{screenToFlowPosition:e}=(0,n._K)(),t=p(e=>e.addNode);return{onDragOver:(0,l.useCallback)(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},[]),onDrop:(0,l.useCallback)(s=>{s.preventDefault();let a=s.dataTransfer.getData("application/islnodetype");a&&t(function(e,t){let s=u();switch(e){case"entity":return{id:s,type:"entityNode",position:t,data:{type:"entity",name:"NewEntity",fields:[{id:"f1",name:"id",type:"UUID",optional:!1,annotations:["@unique"]}],invariants:[]}};case"behavior":return{id:s,type:"behaviorNode",position:t,data:{type:"behavior",name:"NewBehavior",description:"",inputs:[],outputType:"Boolean",errors:[],preconditions:[],postconditions:[]}};case"type":return{id:s,type:"typeNode",position:t,data:{type:"type",name:"NewType",definition:"String",constraints:[]}};case"invariant":return{id:s,type:"invariantNode",position:t,data:{type:"invariant",name:"NewInvariant",scope:"global",predicates:[]}};case"policy":return{id:s,type:"policyNode",position:t,data:{type:"policy",name:"NewPolicy",appliesTo:["all"],rules:[]}};default:throw Error("Unknown node type: ".concat(e))}}(a,e({x:s.clientX,y:s.clientY})))},[e,t]),onDragStart:(0,l.useCallback)((e,t)=>{e.dataTransfer.setData("application/islnodetype",t),e.dataTransfer.effectAllowed="move"},[])}}var b=s(9098),g=s(4866),y=s(1947),f=s(8273),v=s(9842);function j(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,v.m6)((0,f.W)(t))}let N=(0,l.memo)(function(e){let{id:t,data:s,selected:r}=e,o=p(e=>e.selectedNodeId);return(0,a.jsxs)("div",{className:j("min-w-[200px] rounded-lg overflow-hidden","bg-gradient-to-br from-green-900/50 to-green-950/50","border-2 transition-all duration-200",r||o===t?"border-entity shadow-lg shadow-entity/30":"border-green-800/50 hover:border-green-700/70"),children:[(0,a.jsxs)("div",{className:"bg-entity/20 px-3 py-2 flex items-center gap-2 border-b border-green-800/50",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4 text-entity"}),(0,a.jsx)("span",{className:"font-semibold text-entity",children:s.name}),s.lifecycleStates&&s.lifecycleStates.length>0&&(0,a.jsx)("span",{className:"ml-auto text-xs bg-entity/30 px-2 py-0.5 rounded",children:"lifecycle"})]}),(0,a.jsx)("div",{className:"p-2 space-y-1",children:0===s.fields.length?(0,a.jsx)("div",{className:"text-xs text-gray-500 italic px-2 py-1",children:"No fields"}):s.fields.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2 px-2 py-1 rounded bg-green-950/30 text-sm",children:[e.annotations.includes("@unique")&&(0,a.jsx)(g.Z,{className:"w-3 h-3 text-yellow-500"}),(0,a.jsx)("span",{className:"text-gray-300",children:e.name}),(0,a.jsx)("span",{className:"text-gray-500",children:":"}),(0,a.jsx)("span",{className:"text-entity",children:e.type}),e.optional&&(0,a.jsx)("span",{className:"text-gray-500",children:"?"})]},e.id))}),s.invariants.length>0&&(0,a.jsxs)("div",{className:"border-t border-green-800/50 p-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs text-yellow-500 mb-1",children:[(0,a.jsx)(y.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:"Invariants"})]}),s.invariants.map((e,t)=>(0,a.jsx)("div",{className:"text-xs text-gray-400 px-2 py-0.5 font-mono",children:e},t))]}),(0,a.jsx)(n.HH,{type:"target",position:n.Ly.Top,className:"w-3 h-3 !bg-entity border-2 border-green-950"}),(0,a.jsx)(n.HH,{type:"source",position:n.Ly.Bottom,className:"w-3 h-3 !bg-entity border-2 border-green-950"}),(0,a.jsx)(n.HH,{type:"source",position:n.Ly.Right,id:"right",className:"w-3 h-3 !bg-entity border-2 border-green-950"}),(0,a.jsx)(n.HH,{type:"target",position:n.Ly.Left,id:"left",className:"w-3 h-3 !bg-entity border-2 border-green-950"})]})});var w=s(4537),k=s(3942),C=s(7122),I=s(8729);let D=(0,l.memo)(function(e){let{id:t,data:s,selected:r}=e,o=p(e=>e.selectedNodeId);return(0,a.jsxs)("div",{className:j("min-w-[220px] rounded-lg overflow-hidden","bg-gradient-to-br from-blue-900/50 to-blue-950/50","border-2 transition-all duration-200",r||o===t?"border-behavior shadow-lg shadow-behavior/30":"border-blue-800/50 hover:border-blue-700/70"),children:[(0,a.jsxs)("div",{className:"bg-behavior/20 px-3 py-2 flex items-center gap-2 border-b border-blue-800/50",children:[(0,a.jsx)(w.Z,{className:"w-4 h-4 text-behavior"}),(0,a.jsx)("span",{className:"font-semibold text-behavior",children:s.name})]}),s.description&&(0,a.jsx)("div",{className:"px-3 py-1 text-xs text-gray-400 border-b border-blue-800/30",children:s.description}),(0,a.jsxs)("div",{className:"p-2 space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-xs text-gray-500 mb-1 flex items-center gap-1",children:[(0,a.jsx)(k.Z,{className:"w-3 h-3"}),"Input"]}),0===s.inputs.length?(0,a.jsx)("div",{className:"text-xs text-gray-600 italic px-2",children:"None"}):(0,a.jsx)("div",{className:"space-y-0.5",children:s.inputs.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-1 px-2 py-0.5 text-xs",children:[(0,a.jsx)("span",{className:"text-gray-300",children:e.name}),(0,a.jsx)("span",{className:"text-gray-500",children:":"}),(0,a.jsx)("span",{className:"text-behavior",children:e.type})]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-xs text-gray-500 mb-1 flex items-center gap-1",children:[(0,a.jsx)(k.Z,{className:"w-3 h-3 rotate-180"}),"Output"]}),(0,a.jsx)("div",{className:"px-2 py-0.5 text-xs",children:(0,a.jsx)("span",{className:"text-behavior",children:s.outputType})})]}),s.errors.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-xs text-red-400 mb-1 flex items-center gap-1",children:[(0,a.jsx)(C.Z,{className:"w-3 h-3"}),"Errors"]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1 px-2",children:s.errors.map((e,t)=>(0,a.jsx)("span",{className:"text-xs bg-red-900/30 text-red-400 px-1.5 py-0.5 rounded",children:e},t))})]})]}),(s.preconditions.length>0||s.postconditions.length>0)&&(0,a.jsxs)("div",{className:"border-t border-blue-800/50 p-2 space-y-1",children:[s.preconditions.length>0&&(0,a.jsxs)("div",{className:"text-xs",children:[(0,a.jsx)("span",{className:"text-yellow-500",children:"pre:"}),(0,a.jsxs)("span",{className:"text-gray-400 ml-1",children:[s.preconditions.length," condition(s)"]})]}),s.postconditions.length>0&&(0,a.jsxs)("div",{className:"text-xs flex items-center gap-1",children:[(0,a.jsx)(I.Z,{className:"w-3 h-3 text-green-500"}),(0,a.jsxs)("span",{className:"text-gray-400",children:[s.postconditions.length," postcondition(s)"]})]})]}),(0,a.jsx)(n.HH,{type:"target",position:n.Ly.Top,className:"w-3 h-3 !bg-behavior border-2 border-blue-950"}),(0,a.jsx)(n.HH,{type:"source",position:n.Ly.Bottom,className:"w-3 h-3 !bg-behavior border-2 border-blue-950"}),(0,a.jsx)(n.HH,{type:"source",position:n.Ly.Right,id:"right",className:"w-3 h-3 !bg-behavior border-2 border-blue-950"}),(0,a.jsx)(n.HH,{type:"target",position:n.Ly.Left,id:"left",className:"w-3 h-3 !bg-behavior border-2 border-blue-950"})]})});var Z=s(9942);let T=(0,l.memo)(function(e){let{id:t,data:s,selected:r}=e,o=p(e=>e.selectedNodeId);return(0,a.jsxs)("div",{className:j("min-w-[160px] rounded-lg overflow-hidden","bg-gradient-to-br from-pink-900/50 to-pink-950/50","border-2 transition-all duration-200",r||o===t?"border-type shadow-lg shadow-type/30":"border-pink-800/50 hover:border-pink-700/70"),children:[(0,a.jsxs)("div",{className:"bg-type/20 px-3 py-2 flex items-center gap-2 border-b border-pink-800/50",children:[(0,a.jsx)(Z.Z,{className:"w-4 h-4 text-type"}),(0,a.jsx)("span",{className:"font-semibold text-type",children:s.name})]}),(0,a.jsxs)("div",{className:"p-3",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Base type"}),(0,a.jsx)("div",{className:"font-mono text-sm text-gray-300",children:s.definition}),s.constraints.length>0&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Constraints"}),s.constraints.map((e,t)=>(0,a.jsx)("div",{className:"text-xs font-mono text-pink-300 bg-pink-950/50 px-2 py-1 rounded mt-1",children:e},t))]})]}),(0,a.jsx)(n.HH,{type:"target",position:n.Ly.Top,className:"w-3 h-3 !bg-type border-2 border-pink-950"}),(0,a.jsx)(n.HH,{type:"source",position:n.Ly.Bottom,className:"w-3 h-3 !bg-type border-2 border-pink-950"})]})});var H=s(3570);let S=(0,l.memo)(function(e){let{id:t,data:s,selected:r}=e,o=p(e=>e.selectedNodeId);return(0,a.jsxs)("div",{className:j("min-w-[180px] rounded-lg overflow-hidden","bg-gradient-to-br from-red-900/50 to-red-950/50","border-2 transition-all duration-200",r||o===t?"border-highlight shadow-lg shadow-highlight/30":"border-red-800/50 hover:border-red-700/70"),children:[(0,a.jsxs)("div",{className:"bg-highlight/20 px-3 py-2 flex items-center gap-2 border-b border-red-800/50",children:[(0,a.jsx)(H.Z,{className:"w-4 h-4 text-highlight"}),(0,a.jsx)("span",{className:"font-semibold text-highlight",children:s.name}),(0,a.jsx)("span",{className:"ml-auto text-xs bg-red-900/50 px-2 py-0.5 rounded",children:s.scope})]}),(0,a.jsx)("div",{className:"p-3",children:0===s.predicates.length?(0,a.jsx)("div",{className:"text-xs text-gray-500 italic",children:"No predicates"}):(0,a.jsx)("div",{className:"space-y-1",children:s.predicates.map((e,t)=>(0,a.jsx)("div",{className:"text-xs font-mono text-gray-300 bg-red-950/50 px-2 py-1 rounded",children:e},t))})}),(0,a.jsx)(n.HH,{type:"target",position:n.Ly.Top,className:"w-3 h-3 !bg-highlight border-2 border-red-950"}),(0,a.jsx)(n.HH,{type:"source",position:n.Ly.Bottom,className:"w-3 h-3 !bg-highlight border-2 border-red-950"})]})});var L=s(280);let U={entityNode:N,behaviorNode:D,typeNode:T,invariantNode:S,policyNode:(0,l.memo)(function(e){let{id:t,data:s,selected:r}=e,o=p(e=>e.selectedNodeId);return(0,a.jsxs)("div",{className:j("min-w-[180px] rounded-lg overflow-hidden","bg-gradient-to-br from-yellow-900/50 to-yellow-950/50","border-2 transition-all duration-200",r||o===t?"border-yellow-500 shadow-lg shadow-yellow-500/30":"border-yellow-800/50 hover:border-yellow-700/70"),children:[(0,a.jsxs)("div",{className:"bg-yellow-500/20 px-3 py-2 flex items-center gap-2 border-b border-yellow-800/50",children:[(0,a.jsx)(L.Z,{className:"w-4 h-4 text-yellow-500"}),(0,a.jsx)("span",{className:"font-semibold text-yellow-500",children:s.name})]}),(0,a.jsxs)("div",{className:"p-3",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Applies to"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:s.appliesTo.map((e,t)=>(0,a.jsx)("span",{className:"text-xs bg-yellow-900/30 text-yellow-400 px-2 py-0.5 rounded",children:e},t))}),s.rules.length>0&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Rules"}),s.rules.map((e,t)=>(0,a.jsx)("div",{className:"text-xs font-mono text-gray-300 bg-yellow-950/50 px-2 py-1 rounded mt-1",children:e},t))]})]}),(0,a.jsx)(n.HH,{type:"target",position:n.Ly.Top,className:"w-3 h-3 !bg-yellow-500 border-2 border-yellow-950"}),(0,a.jsx)(n.HH,{type:"source",position:n.Ly.Bottom,className:"w-3 h-3 !bg-yellow-500 border-2 border-yellow-950"})]})})};function E(){let{nodes:e,edges:t,onNodesChange:s,onEdgesChange:c,onConnect:d,onNodeClick:x,onEdgeClick:h,onPaneClick:u}=function(){let{project:e,fitView:t,zoomIn:s,zoomOut:a,setViewport:r,getViewport:o}=(0,n._K)(),{nodes:i,edges:c,setNodes:d,setEdges:x,addEdge:h,selectNode:u,selectEdge:m,setZoom:b}=p(),g=(0,l.useCallback)(e=>{d((0,n.Fb)(e,i))},[i,d]),y=(0,l.useCallback)(e=>{x((0,n.yn)(e,c))},[c,x]),f=(0,l.useCallback)(e=>{if(!e.source||!e.target)return;let t=i.find(t=>t.id===e.source),s=i.find(t=>t.id===e.target);if(!t||!s)return;let a="reference",n=!1;"behavior"===t.data.type&&"entity"===s.data.type?a="uses":"entity"===t.data.type&&"behavior"===s.data.type?a="produces":"policy"===t.data.type||"invariant"===t.data.type?a="enforces":"entity"===t.data.type&&"entity"===s.data.type&&(a="lifecycle",n=!0),h({id:"e-".concat(e.source,"-").concat(e.target),source:e.source,target:e.target,sourceHandle:e.sourceHandle||void 0,targetHandle:e.targetHandle||void 0,data:{type:a},animated:n,style:{stroke:function(e){switch(e){case"uses":return"#60a5fa";case"produces":return"#4ade80";case"consumes":return"#f472b6";case"lifecycle":return"#fbbf24";case"enforces":return"#e94560";default:return"#94a3b8"}}(a)}})},[i,h]),v=(0,l.useCallback)((e,t)=>{u(t.id)},[u]),j=(0,l.useCallback)((e,t)=>{m(t.id)},[m]),N=(0,l.useCallback)(()=>{u(null),m(null)},[u,m]),w=(0,l.useCallback)(()=>{s(),b(o().zoom)},[s,o,b]);return{nodes:i,edges:c,onNodesChange:g,onEdgesChange:y,onConnect:f,onNodeClick:v,onEdgeClick:j,onPaneClick:N,handleZoomIn:w,handleZoomOut:(0,l.useCallback)(()=>{a(),b(o().zoom)},[a,o,b]),handleFitView:(0,l.useCallback)(()=>{t({padding:.2}),b(o().zoom)},[t,o,b]),handleCenter:(0,l.useCallback)(()=>{r({x:0,y:0,zoom:1}),b(1)},[r,b]),project:e}}(),{onDragOver:b,onDrop:g}=m();return(0,a.jsxs)(n.x$,{nodes:e,edges:t,onNodesChange:s,onEdgesChange:c,onConnect:d,onNodeClick:x,onEdgeClick:h,onPaneClick:u,onDragOver:b,onDrop:g,nodeTypes:U,fitView:!0,snapToGrid:!0,snapGrid:[16,16],defaultEdgeOptions:{type:"smoothstep",animated:!1},proOptions:{hideAttribution:!0},children:[(0,a.jsx)(r.A,{variant:r.T.Dots,gap:16,size:1,color:"#2d3748"}),(0,a.jsx)(o.Z,{showZoom:!0,showFitView:!0,showInteractive:!1,className:"bg-panel border border-accent"}),(0,a.jsx)(i.a,{nodeColor:e=>{var t;return function(e){switch(e){case"entity":return"#4ade80";case"behavior":return"#60a5fa";case"type":return"#f472b6";case"invariant":return"#e94560";case"policy":return"#fbbf24";default:return"#94a3b8"}}(null===(t=e.data)||void 0===t?void 0:t.type)},maskColor:"rgba(22, 33, 62, 0.8)",className:"bg-panel border border-accent"})]})}var B=s(1457);let O=[{id:"entity",type:"entity",label:"Entity",icon:"database",description:"Data model with fields and invariants"},{id:"behavior",type:"behavior",label:"Behavior",icon:"workflow",description:"Operation with pre/postconditions"},{id:"type",type:"type",label:"Type",icon:"type",description:"Custom type definition"},{id:"invariant",type:"invariant",label:"Invariant",icon:"shield",description:"Global constraint"},{id:"policy",type:"policy",label:"Policy",icon:"scale",description:"Business rule"}],_={database:b.Z,workflow:w.Z,type:Z.Z,shield:H.Z,scale:L.Z};function P(){let{onDragStart:e}=m(),[t,s]=(0,l.useState)(["components"]),n=e=>{s(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])};return(0,a.jsxs)("aside",{className:"w-64 bg-panel border-r border-accent flex flex-col",children:[(0,a.jsxs)("div",{className:"border-b border-accent",children:[(0,a.jsxs)("button",{onClick:()=>n("components"),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-accent/30 transition-colors",children:[(0,a.jsx)("span",{className:"font-semibold text-sm uppercase tracking-wider",children:"Components"}),(0,a.jsx)(B.Z,{className:"w-4 h-4 transition-transform ".concat(t.includes("components")?"":"-rotate-90")})]}),t.includes("components")&&(0,a.jsx)("div",{className:"p-2 space-y-1",children:O.map(t=>(0,a.jsx)(z,{tool:t,onDragStart:e},t.id))})]}),(0,a.jsxs)("div",{className:"border-b border-accent",children:[(0,a.jsxs)("button",{onClick:()=>n("templates"),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-accent/30 transition-colors",children:[(0,a.jsx)("span",{className:"font-semibold text-sm uppercase tracking-wider",children:"Templates"}),(0,a.jsx)(B.Z,{className:"w-4 h-4 transition-transform ".concat(t.includes("templates")?"":"-rotate-90")})]}),t.includes("templates")&&(0,a.jsx)("div",{className:"p-4 text-sm text-gray-400",children:"Coming soon: Pre-built patterns"})]}),(0,a.jsx)("div",{className:"mt-auto p-4 border-t border-accent",children:(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[(0,a.jsxs)("p",{className:"mb-2",children:[(0,a.jsx)("strong",{children:"Tip:"})," Drag components onto the canvas"]}),(0,a.jsx)("p",{children:"Connect nodes by dragging from handles"})]})})]})}function z(e){let{tool:t,onDragStart:s}=e,n=_[t.icon],r=function(e){switch(e){case"entity":return"entity";case"behavior":return"behavior";case"type":return"type";case"invariant":case"policy":return"highlight";default:return"gray-400"}}(t.type);return(0,a.jsxs)("div",{draggable:!0,onDragStart:e=>s(e,t.type),className:"\n        flex items-center gap-3 p-3 rounded-lg cursor-grab\n        bg-accent/30 hover:bg-accent/50 border border-transparent\n        hover:border-".concat(r,"/50 transition-all\n        active:cursor-grabbing\n      "),children:[(0,a.jsx)("div",{className:"p-2 rounded-lg bg-".concat(r,"/20"),children:(0,a.jsx)(n,{className:"w-5 h-5 text-".concat(r)})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-sm",children:t.label}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:t.description})]})]})}var F=s(4211),R=s(5432),V=s(1118);function $(){let e=x(),t=p(e=>e.updateNode),s=p(e=>e.removeNode);if(!e)return(0,a.jsxs)("div",{className:"flex-1 p-4 border-b border-accent",children:[(0,a.jsx)("h2",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4",children:"Properties"}),(0,a.jsx)("div",{className:"text-sm text-gray-500 text-center py-8",children:"Select a node to edit its properties"})]});let{data:n}=e;return(0,a.jsxs)("div",{className:"flex-1 p-4 border-b border-accent overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider",children:"Properties"}),(0,a.jsx)("button",{onClick:()=>s(e.id),className:"p-1.5 hover:bg-red-900/30 rounded text-red-400 transition-colors",title:"Delete node",children:(0,a.jsx)(F.Z,{className:"w-4 h-4"})})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Name"}),(0,a.jsx)("input",{type:"text",value:n.name,onChange:s=>t(e.id,{name:s.target.value}),className:"w-full bg-accent/50 border border-accent rounded px-3 py-2 text-sm focus:outline-none focus:border-highlight"})]}),"entity"===n.type&&(0,a.jsx)(A,{data:n,onUpdate:s=>t(e.id,s)}),"behavior"===n.type&&(0,a.jsx)(M,{data:n,onUpdate:s=>t(e.id,s)}),"type"===n.type&&(0,a.jsx)(G,{data:n,onUpdate:s=>t(e.id,s)})]})}function A(e){let{data:t,onUpdate:s}=e,n=(e,a)=>{s({fields:t.fields.map(t=>t.id===e?{...t,...a}:t)})},r=e=>{s({fields:t.fields.filter(t=>t.id!==e)})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("label",{className:"text-xs text-gray-500",children:"Fields"}),(0,a.jsx)("button",{onClick:()=>{let e={id:"f".concat(Date.now()),name:"newField",type:"String",optional:!1,annotations:[]};s({fields:[...t.fields,e]})},className:"p-1 hover:bg-accent rounded transition-colors",children:(0,a.jsx)(R.Z,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"space-y-2",children:t.fields.map(e=>(0,a.jsxs)("div",{className:"bg-accent/30 rounded p-2 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"text",value:e.name,onChange:t=>n(e.id,{name:t.target.value}),className:"flex-1 bg-accent/50 border border-accent rounded px-2 py-1 text-xs focus:outline-none focus:border-highlight",placeholder:"Field name"}),(0,a.jsx)("button",{onClick:()=>r(e.id),className:"p-1 hover:bg-red-900/30 rounded text-red-400",children:(0,a.jsx)(V.Z,{className:"w-3 h-3"})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("select",{value:e.type,onChange:t=>n(e.id,{type:t.target.value}),className:"flex-1 bg-accent/50 border border-accent rounded px-2 py-1 text-xs focus:outline-none",children:[(0,a.jsx)("option",{value:"String",children:"String"}),(0,a.jsx)("option",{value:"Int",children:"Int"}),(0,a.jsx)("option",{value:"Boolean",children:"Boolean"}),(0,a.jsx)("option",{value:"UUID",children:"UUID"}),(0,a.jsx)("option",{value:"Timestamp",children:"Timestamp"}),(0,a.jsx)("option",{value:"Decimal",children:"Decimal"})]}),(0,a.jsxs)("label",{className:"flex items-center gap-1 text-xs",children:[(0,a.jsx)("input",{type:"checkbox",checked:e.optional,onChange:t=>n(e.id,{optional:t.target.checked}),className:"w-3 h-3"}),"Optional"]})]})]},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Invariants (one per line)"}),(0,a.jsx)("textarea",{value:t.invariants.join("\n"),onChange:e=>s({invariants:e.target.value.split("\n").filter(e=>e.trim())}),className:"w-full bg-accent/50 border border-accent rounded px-3 py-2 text-xs font-mono h-20 resize-none focus:outline-none focus:border-highlight",placeholder:"e.g., balance >= 0"})]})]})}function M(e){let{data:t,onUpdate:s}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Description"}),(0,a.jsx)("input",{type:"text",value:t.description||"",onChange:e=>s({description:e.target.value}),className:"w-full bg-accent/50 border border-accent rounded px-3 py-2 text-sm focus:outline-none focus:border-highlight",placeholder:"What does this behavior do?"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("label",{className:"text-xs text-gray-500",children:"Inputs"}),(0,a.jsx)("button",{onClick:()=>{let e={id:"i".concat(Date.now()),name:"input",type:"String",optional:!1,annotations:[]};s({inputs:[...t.inputs,e]})},className:"p-1 hover:bg-accent rounded transition-colors",children:(0,a.jsx)(R.Z,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"space-y-2",children:t.inputs.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"text",value:e.name,onChange:a=>s({inputs:t.inputs.map(t=>t.id===e.id?{...t,name:a.target.value}:t)}),className:"flex-1 bg-accent/50 border border-accent rounded px-2 py-1 text-xs focus:outline-none"}),(0,a.jsxs)("select",{value:e.type,onChange:a=>s({inputs:t.inputs.map(t=>t.id===e.id?{...t,type:a.target.value}:t)}),className:"bg-accent/50 border border-accent rounded px-2 py-1 text-xs",children:[(0,a.jsx)("option",{value:"String",children:"String"}),(0,a.jsx)("option",{value:"Int",children:"Int"}),(0,a.jsx)("option",{value:"Boolean",children:"Boolean"}),(0,a.jsx)("option",{value:"UUID",children:"UUID"})]}),(0,a.jsx)("button",{onClick:()=>s({inputs:t.inputs.filter(t=>t.id!==e.id)}),className:"p-1 hover:bg-red-900/30 rounded text-red-400",children:(0,a.jsx)(V.Z,{className:"w-3 h-3"})})]},e.id))})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Output Type"}),(0,a.jsxs)("select",{value:t.outputType,onChange:e=>s({outputType:e.target.value}),className:"w-full bg-accent/50 border border-accent rounded px-3 py-2 text-sm focus:outline-none",children:[(0,a.jsx)("option",{value:"Boolean",children:"Boolean"}),(0,a.jsx)("option",{value:"String",children:"String"}),(0,a.jsx)("option",{value:"Int",children:"Int"}),(0,a.jsx)("option",{value:"UUID",children:"UUID"}),(0,a.jsx)("option",{value:"void",children:"void"})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Preconditions"}),(0,a.jsx)("textarea",{value:t.preconditions.join("\n"),onChange:e=>s({preconditions:e.target.value.split("\n").filter(e=>e.trim())}),className:"w-full bg-accent/50 border border-accent rounded px-3 py-2 text-xs font-mono h-16 resize-none focus:outline-none focus:border-highlight",placeholder:"e.g., input.amount > 0"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Postconditions"}),(0,a.jsx)("textarea",{value:t.postconditions.join("\n"),onChange:e=>s({postconditions:e.target.value.split("\n").filter(e=>e.trim())}),className:"w-full bg-accent/50 border border-accent rounded px-3 py-2 text-xs font-mono h-16 resize-none focus:outline-none focus:border-highlight",placeholder:"e.g., result == true"})]})]})}function G(e){let{data:t,onUpdate:s}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Base Type"}),(0,a.jsxs)("select",{value:t.definition,onChange:e=>s({definition:e.target.value}),className:"w-full bg-accent/50 border border-accent rounded px-3 py-2 text-sm focus:outline-none",children:[(0,a.jsx)("option",{value:"String",children:"String"}),(0,a.jsx)("option",{value:"Int",children:"Int"}),(0,a.jsx)("option",{value:"Decimal",children:"Decimal"}),(0,a.jsx)("option",{value:"Boolean",children:"Boolean"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Constraints (one per line)"}),(0,a.jsx)("textarea",{value:t.constraints.join("\n"),onChange:e=>s({constraints:e.target.value.split("\n").filter(e=>e.trim())}),className:"w-full bg-accent/50 border border-accent rounded px-3 py-2 text-xs font-mono h-20 resize-none focus:outline-none focus:border-highlight",placeholder:'e.g., format: "email"'})]})]})}var q=s(1372),K=s(9902);function W(){let e=p(e=>e.nodes),t=p(e=>e.edges),s=p(e=>e.domainName),a=p(e=>e.domainVersion);return{islCode:(0,l.useMemo)(()=>(function(e){let{nodes:t,edges:s,domainName:a,domainVersion:n}=e,r=[];r.push("domain ".concat(a," {")),r.push('  version: "'.concat(n,'"')),r.push("");let o=t.filter(e=>"type"===e.data.type),i=t.filter(e=>"entity"===e.data.type),l=t.filter(e=>"behavior"===e.data.type),c=t.filter(e=>"invariant"===e.data.type),d=t.filter(e=>"policy"===e.data.type);if(o.length>0)for(let e of(r.push("  // Types"),o))r.push(...(function(e){let t=[];if(0===e.constraints.length)t.push("type ".concat(e.name," = ").concat(e.definition));else{for(let s of(t.push("type ".concat(e.name," = ").concat(e.definition," {")),e.constraints))t.push("  ".concat(s));t.push("}")}return t})(e.data).map(e=>"  ".concat(e))),r.push("");if(i.length>0)for(let e of(r.push("  // Entities"),i))r.push(...(function(e){let t=[];for(let s of(t.push("entity ".concat(e.name," {")),e.fields)){let e=s.annotations.length>0?" ".concat(s.annotations.join(" ")):"",a=s.optional?"?":"";t.push("  ".concat(s.name,": ").concat(s.type).concat(a).concat(e))}if(e.invariants.length>0){for(let s of(t.push(""),t.push("  invariant {"),e.invariants))t.push("    ".concat(s));t.push("  }")}if(e.lifecycleStates&&e.lifecycleStates.length>0){t.push(""),t.push("  lifecycle {");for(let s=0;s<e.lifecycleStates.length-1;s++)t.push("    ".concat(e.lifecycleStates[s]," -> ").concat(e.lifecycleStates[s+1]));t.push("  }")}return t.push("}"),t})(e.data).map(e=>"  ".concat(e))),r.push("");if(l.length>0)for(let e of(r.push("  // Behaviors"),l))r.push(...(function(e){let t=[];for(let s of(t.push("behavior ".concat(e.name," {")),e.description&&(t.push('  description: "'.concat(e.description,'"')),t.push("")),t.push("  input {"),e.inputs)){let e=s.optional?"?":"";t.push("    ".concat(s.name,": ").concat(s.type).concat(e))}if(t.push("  }"),t.push(""),t.push("  output {"),t.push("    success: ".concat(e.outputType)),e.errors.length>0)for(let s of(t.push(""),e.errors))t.push("    error ".concat(s));if(t.push("  }"),e.preconditions.length>0){for(let s of(t.push(""),t.push("  pre {"),e.preconditions))t.push("    ".concat(s));t.push("  }")}if(e.postconditions.length>0){for(let s of(t.push(""),t.push("  post {"),e.postconditions))t.push("    ".concat(s));t.push("  }")}return t.push("}"),t})(e.data).map(e=>"  ".concat(e))),r.push("");if(c.length>0)for(let e of(r.push("  // Invariants"),c))r.push(...(function(e){let t=[];if(t.push("invariant ".concat(e.name," {")),t.push("  scope: ".concat(e.scope)),e.predicates.length>0)for(let s of(t.push(""),e.predicates))t.push("  ".concat(s));return t.push("}"),t})(e.data).map(e=>"  ".concat(e))),r.push("");if(d.length>0)for(let e of(r.push("  // Policies"),d))r.push(...(function(e){let t=[];t.push("policy ".concat(e.name," {"));let s=e.appliesTo.includes("all")?"all":e.appliesTo.join(", ");if(t.push("  applies_to: ".concat(s)),e.rules.length>0){for(let s of(t.push(""),t.push("  rules {"),e.rules))t.push("    ".concat(s));t.push("  }")}return t.push("}"),t})(e.data).map(e=>"  ".concat(e))),r.push("");return r.push("}"),r.join("\n")})({nodes:e,edges:t,domainName:s,domainVersion:a}),[e,t,s,a]),domainName:s,domainVersion:a}}function Y(){let{islCode:e,domainName:t,domainVersion:s}=W(),[n,r]=(0,l.useState)(!1),o=async()=>{await navigator.clipboard.writeText(e),r(!0),setTimeout(()=>r(!1),2e3)};return(0,a.jsxs)("div",{className:"flex-1 flex flex-col min-h-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 border-b border-accent",children:[(0,a.jsx)("h2",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider",children:"ISL Preview"}),(0,a.jsx)("button",{onClick:o,className:"p-1.5 hover:bg-accent rounded transition-colors",title:"Copy to clipboard",children:n?(0,a.jsx)(q.Z,{className:"w-4 h-4 text-green-500"}):(0,a.jsx)(K.Z,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"flex-1 overflow-auto p-4",children:(0,a.jsx)("pre",{className:"code-preview text-xs leading-relaxed",children:(0,a.jsx)("code",{dangerouslySetInnerHTML:{__html:e.replace(/\b(domain|entity|behavior|type|invariant|policy|input|output|pre|post|error|lifecycle|temporal|security)\b/g,'<span class="keyword">$1</span>').replace(/\b(String|Int|Boolean|UUID|Timestamp|Decimal|Duration|List|Map|Optional)\b/g,'<span class="type">$1</span>').replace(/"([^"\\]|\\.)*"/g,'<span class="string">$&</span>').replace(/\b(\d+(\.\d+)?)\b/g,'<span class="number">$1</span>').replace(/(\/\/.*$)/gm,'<span class="comment">$1</span>').replace(/(@\w+)/g,'<span class="keyword">$1</span>')}})})})]})}var X=s(5289),J=s(8254),Q=s(7270),ee=s(4395),et=s(8162),es=s(8607),ea=s(7508);function en(){let{domainName:e,domainVersion:t,isDirty:s,setDomainInfo:n,resetEditor:r}=p(),{islCode:o}=W();return(0,a.jsxs)("header",{className:"h-14 bg-panel border-b border-accent flex items-center justify-between px-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(X.Z,{className:"w-6 h-6 text-highlight"}),(0,a.jsx)("span",{className:"font-bold text-lg",children:"ISL Editor"})]}),(0,a.jsx)("div",{className:"h-6 w-px bg-accent"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"text",value:e,onChange:e=>n(e.target.value,t),className:"bg-accent/50 border border-accent rounded px-2 py-1 text-sm w-36 focus:outline-none focus:border-highlight",placeholder:"Domain name"}),(0,a.jsx)("span",{className:"text-gray-500",children:"v"}),(0,a.jsx)("input",{type:"text",value:t,onChange:t=>n(e,t.target.value),className:"bg-accent/50 border border-accent rounded px-2 py-1 text-sm w-20 focus:outline-none focus:border-highlight",placeholder:"Version"}),s&&(0,a.jsx)("span",{className:"w-2 h-2 rounded-full bg-highlight",title:"Unsaved changes"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>{(!s||confirm("You have unsaved changes. Create new specification?"))&&r()},className:"p-2 hover:bg-accent rounded-lg transition-colors",title:"New",children:(0,a.jsx)(X.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{className:"p-2 hover:bg-accent rounded-lg transition-colors",title:"Undo",children:(0,a.jsx)(J.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{className:"p-2 hover:bg-accent rounded-lg transition-colors",title:"Redo",children:(0,a.jsx)(Q.Z,{className:"w-5 h-5"})}),(0,a.jsx)("div",{className:"h-6 w-px bg-accent mx-2"}),(0,a.jsx)("button",{className:"p-2 hover:bg-accent rounded-lg transition-colors",title:"Import ISL",children:(0,a.jsx)(ee.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{onClick:()=>{let t=new Blob([o],{type:"text/plain"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download="".concat(e.toLowerCase(),".isl"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s)},className:"p-2 hover:bg-accent rounded-lg transition-colors",title:"Export ISL",children:(0,a.jsx)(et.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{className:"p-2 hover:bg-accent rounded-lg transition-colors",title:"Save",children:(0,a.jsx)(es.Z,{className:"w-5 h-5"})})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("button",{className:"p-2 hover:bg-accent rounded-lg transition-colors",title:"Settings",children:(0,a.jsx)(ea.Z,{className:"w-5 h-5"})})})]})}function er(){return(0,a.jsx)(n.tV,{children:(0,a.jsxs)("div",{className:"h-screen w-screen flex flex-col overflow-hidden bg-canvas",children:[(0,a.jsx)(en,{}),(0,a.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,a.jsx)(P,{}),(0,a.jsx)("div",{className:"flex-1 relative",children:(0,a.jsx)(E,{})}),(0,a.jsxs)("div",{className:"w-96 flex flex-col border-l border-accent bg-panel",children:[(0,a.jsx)($,{}),(0,a.jsx)(Y,{})]})]})]})})}}},function(e){e.O(0,[560,836,852,999,744],function(){return e(e.s=8181)}),_N_E=e.O()}]);