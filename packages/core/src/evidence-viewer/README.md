# Evidence Viewer

Static HTML report generator for ISL evidence reports. Converts `evidence-report.json` files into beautiful, self-contained HTML documents.

## Features

- **Score Card** - Visual summary with overall score, pass/partial/fail counts, and ship decision
- **Clause Results** - Grouped lists showing FAIL, PARTIAL, and PASS clauses with details
- **Assumptions** - Impact-colored list of verification assumptions
- **Open Questions** - Priority-sorted questions identified during verification
- **Artifacts** - Grid of collected artifacts with file links
- **Themes** - Light and dark mode support
- **Text Summary** - Plain text output for terminals and logs

## Usage

### Basic HTML Report

```typescript
import { renderHtml } from '@isl-lang/core/evidence-viewer';
import fs from 'fs';

const report = JSON.parse(fs.readFileSync('evidence-report.json', 'utf-8'));
const html = renderHtml(report);
fs.writeFileSync('report.html', html);
```

### With Options

```typescript
const html = renderHtml(report, {
  title: 'My Verification Report',
  darkMode: true,
  showTimestamp: true,
  artifactBasePath: './artifacts',
  footerText: 'Generated by MyTool v1.0',
});
```

### Text Summary (Terminal)

```typescript
import { renderTextSummary } from '@isl-lang/core/evidence-viewer';

const text = renderTextSummary(report);
console.log(text);
```

Output:
```
═══════════════════════════════════════════════════════════
  ISL EVIDENCE REPORT: UserAuth
═══════════════════════════════════════════════════════════

  SCORE: 85/100  |  DECISION: SHIP
  Confidence: high  |  Pass Rate: 90.0%

  ┌─────────────────────────────────────────────────────────┐
  │  PASS:  18  │  PARTIAL:   2  │  FAIL:   0  │
  └─────────────────────────────────────────────────────────┘

  PARTIAL CLAUSES (2):
    ◐ pre.1: Email validation incomplete
    ◐ post.3: Timing constraint borderline

  ...
```

### Summary Card Only

```typescript
import { renderSummaryCard } from '@isl-lang/core/evidence-viewer';

// For embedding in dashboards
const cardHtml = renderSummaryCard(report, { darkMode: false });
```

### Clauses Only

```typescript
import { renderClausesOnly } from '@isl-lang/core/evidence-viewer';

// For partial updates
const clausesHtml = renderClausesOnly(report.clauseResults);
```

## API Reference

### `renderHtml(report, options?)`

Renders a complete HTML report.

**Parameters:**
- `report: EvidenceReport` - The evidence report object
- `options?: RenderOptions` - Optional rendering configuration

**Returns:** `string` - Complete HTML document

### `RenderOptions`

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `title` | `string` | `specName` or `'Evidence Report'` | Report title |
| `includeStyles` | `boolean` | `true` | Include inline CSS |
| `showTimestamp` | `boolean` | `true` | Show generation timestamp |
| `collapsePassed` | `boolean` | `false` | Collapse passed clauses by default |
| `classPrefix` | `string` | `'ev'` | CSS class prefix |
| `artifactBasePath` | `string` | `'.'` | Base path for artifact links |
| `fullDocument` | `boolean` | `true` | Render as complete HTML document |
| `footerText` | `string` | `'Generated by ISL Evidence Viewer'` | Custom footer text |
| `darkMode` | `boolean` | `false` | Use dark theme |

### `renderTextSummary(report)`

Renders a plain text summary for terminal output.

**Parameters:**
- `report: EvidenceReport` - The evidence report object

**Returns:** `string` - Plain text summary

### `renderSummaryCard(report, options?)`

Renders only the score card section.

**Parameters:**
- `report: EvidenceReport` - The evidence report object
- `options?: { classPrefix?, darkMode? }` - Style options

**Returns:** `string` - HTML fragment with styles

### `renderClausesOnly(clauses, options?)`

Renders only the clause lists.

**Parameters:**
- `clauses: EvidenceClauseResult[]` - Array of clause results
- `options?: { classPrefix?, darkMode? }` - Style options

**Returns:** `string` - HTML fragment with styles

### Helper Functions

```typescript
import {
  groupClausesByState,  // Group clauses into PASS/PARTIAL/FAIL
  calculateStats,       // Calculate report statistics
  escapeHtml,          // Escape HTML special characters
  formatDate,          // Format ISO date strings
  formatDuration,      // Format milliseconds to human-readable
} from '@isl-lang/core/evidence-viewer';
```

## Themes

### Light Theme (Default)

```typescript
import { lightTheme } from '@isl-lang/core/evidence-viewer';
```

### Dark Theme

```typescript
import { darkTheme } from '@isl-lang/core/evidence-viewer';

const html = renderHtml(report, { darkMode: true });
```

## Report Structure

The viewer expects an `EvidenceReport` object with this structure:

```typescript
interface EvidenceReport {
  version: '1.0';
  reportId: string;
  specFingerprint: string;
  specName?: string;
  specPath?: string;
  clauseResults: EvidenceClauseResult[];
  scoreSummary: ScoreSummary;
  assumptions: Assumption[];
  openQuestions: OpenQuestion[];
  artifacts: EvidenceArtifact[];
  metadata: VerificationMetadata;
  notes?: string;
}
```

See `../evidence/evidenceTypes.ts` for full type definitions.

## Custom Rendering

For advanced customization, import individual template functions:

```typescript
import {
  generateStyles,
  renderBadge,
  renderScoreCard,
  renderClauseItem,
  renderClauseList,
  renderAssumptions,
  renderOpenQuestions,
  renderArtifacts,
  renderHeader,
  renderFooter,
  wrapInDocument,
} from '@isl-lang/core/evidence-viewer';

// Build custom layout
const styles = generateStyles(lightTheme, 'my-prefix');
const header = renderHeader(title, specPath, fingerprint, metadata, true, 'my-prefix');
const score = renderScoreCard(summary, 'my-prefix', lightTheme);
// ... compose as needed
```

## Example Output

When rendered, the HTML report shows:

1. **Header** - Report title, spec path, fingerprint, timestamp, agent version
2. **Score Card** - Large score number, pass/partial/fail stats, recommendation badge
3. **Failed Clauses** - Red-highlighted list (shown first for visibility)
4. **Partial Clauses** - Orange-highlighted list
5. **Passed Clauses** - Green-highlighted list
6. **Assumptions** - Impact-colored dots with descriptions
7. **Open Questions** - Priority badges with suggested actions
8. **Artifacts** - Grid layout with type badges and file links
9. **Notes** - Optional free-form notes section
10. **Footer** - Generation info

## Integration

### CLI Usage

```bash
# Generate HTML from JSON
isl evidence-report report.json > report.html

# Open in browser
open report.html
```

### Watch Mode

```typescript
import { watch } from 'fs';
import { renderHtml } from '@isl-lang/core/evidence-viewer';

watch('evidence-report.json', () => {
  const report = JSON.parse(fs.readFileSync('evidence-report.json', 'utf-8'));
  const html = renderHtml(report);
  fs.writeFileSync('report.html', html);
  console.log('Report updated');
});
```
