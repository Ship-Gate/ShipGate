"use strict";(()=>{var e={};e.id=570,e.ids=[570],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},1282:e=>{e.exports=require("child_process")},4770:e=>{e.exports=require("crypto")},7702:e=>{e.exports=require("events")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},6807:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>v,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>E,staticGenerationAsyncStorage:()=>h});var o={};t.r(o),t.d(o,{POST:()=>c});var s=t(2070),i=t(1566),n=t(4585),a=t(7481),p=t(34),u=t(1876);async function c(e){let r=await e.text(),t=e.headers.get("stripe-signature");if(!t)return a.NextResponse.json({error:"No signature"},{status:400});try{let e=p.A.webhooks.constructEvent(r,t,process.env.STRIPE_WEBHOOK_SECRET);if("checkout.session.completed"===e.type){let r=e.data.object,t=r.metadata.tier,o=r.metadata.email,s=new Date;s.setFullYear(s.getFullYear()+1);let i="enterprise"===t?999:"team"===t?10:1,n=(0,u.LB)({tier:t,email:o,expiresAt:s.toISOString(),repoCount:i,features:(0,u.LC)(t)});console.log("License generated:",{email:o,tier:t,licenseKey:n})}return a.NextResponse.json({received:!0})}catch(e){return console.error("Webhook error:",e),a.NextResponse.json({error:"Webhook processing failed"},{status:400})}}let l=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/webhook/route",pathname:"/api/webhook",filename:"route",bundlePath:"app/api/webhook/route"},resolvedPagePath:"C:\\Users\\mevla\\OneDrive\\Desktop\\projects\\IntentOS\\packages\\isl-verify-monorepo\\packages\\license-server\\src\\app\\api\\webhook\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:E}=l,m="/api/webhook/route";function v(){return(0,n.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:h})}},1876:(e,r,t)=>{t.d(r,{LB:()=>n,LC:()=>p,Tx:()=>a});var o=t(1769),s=t.n(o);let i=process.env.LICENSE_JWT_SECRET||"default-secret-change-me";function n(e){let r={...e,issuer:"shipgate",issuedAt:new Date().toISOString()};return s().sign(r,i,{algorithm:"HS256"})}function a(e){return s().verify(e,i,{algorithms:["HS256"]})}function p(e){return({free:["tier1"],team:["tier1","tier2","tier3","github-action","compliance","dashboard"],enterprise:["tier1","tier2","tier3","github-action","compliance","dashboard","sso","custom-provers","on-prem","sla","audit-export"]})[e]||[]}},34:(e,r,t)=>{t.d(r,{A:()=>s,c:()=>i});var o=t(5267);if(!process.env.STRIPE_SECRET_KEY)throw Error("STRIPE_SECRET_KEY is not set");let s=new o.Z(process.env.STRIPE_SECRET_KEY,{apiVersion:"2023-10-16",typescript:!0}),i={team:process.env.STRIPE_PRICE_ID_TEAM||"",enterprise:process.env.STRIPE_PRICE_ID_ENTERPRISE||""}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[406,525,267,769],()=>t(6807));module.exports=o})();