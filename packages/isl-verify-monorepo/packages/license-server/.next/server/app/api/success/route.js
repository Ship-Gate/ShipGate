"use strict";(()=>{var e={};e.id=707,e.ids=[707],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},1282:e=>{e.exports=require("child_process")},4770:e=>{e.exports=require("crypto")},7702:e=>{e.exports=require("events")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},2125:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>E,patchFetch:()=>v,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>x,staticGenerationAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{GET:()=>c});var o=t(2070),i=t(1566),n=t(4585),a=t(7481),p=t(34),u=t(1876);async function c(e){try{let r=e.nextUrl.searchParams.get("session_id");if(!r)return a.NextResponse.json({error:"Missing session_id"},{status:400});let t=await p.A.checkout.sessions.retrieve(r);if("paid"!==t.payment_status)return a.NextResponse.json({error:"Payment not completed"},{status:400});let s=t.metadata?.tier,o=t.metadata?.email||t.customer_email;if(!s||!o)return a.NextResponse.json({error:"Missing metadata"},{status:400});let i=new Date;i.setFullYear(i.getFullYear()+1);let n="enterprise"===s?999:"team"===s?10:1,c=(0,u.LB)({tier:s,email:o,expiresAt:i.toISOString(),repoCount:n,features:(0,u.LC)(s)});return a.NextResponse.json({licenseKey:c,tier:s,email:o,expiresAt:i.toISOString()})}catch(e){return console.error("Success route error:",e),a.NextResponse.json({error:"Failed to process payment"},{status:500})}}let l=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/success/route",pathname:"/api/success",filename:"route",bundlePath:"app/api/success/route"},resolvedPagePath:"C:\\Users\\mevla\\OneDrive\\Desktop\\projects\\IntentOS\\packages\\isl-verify-monorepo\\packages\\license-server\\src\\app\\api\\success\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:x}=l,E="/api/success/route";function v(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:m})}},1876:(e,r,t)=>{t.d(r,{LB:()=>n,LC:()=>p,Tx:()=>a});var s=t(1769),o=t.n(s);let i=process.env.LICENSE_JWT_SECRET||"default-secret-change-me";function n(e){let r={...e,issuer:"shipgate",issuedAt:new Date().toISOString()};return o().sign(r,i,{algorithm:"HS256"})}function a(e){return o().verify(e,i,{algorithms:["HS256"]})}function p(e){return({free:["tier1"],team:["tier1","tier2","tier3","github-action","compliance","dashboard"],enterprise:["tier1","tier2","tier3","github-action","compliance","dashboard","sso","custom-provers","on-prem","sla","audit-export"]})[e]||[]}},34:(e,r,t)=>{t.d(r,{A:()=>o,c:()=>i});var s=t(5267);if(!process.env.STRIPE_SECRET_KEY)throw Error("STRIPE_SECRET_KEY is not set");let o=new s.Z(process.env.STRIPE_SECRET_KEY,{apiVersion:"2023-10-16",typescript:!0}),i={team:process.env.STRIPE_PRICE_ID_TEAM||"",enterprise:process.env.STRIPE_PRICE_ID_ENTERPRISE||""}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[406,525,267,769],()=>t(2125));module.exports=s})();