# GitLab CI Component for Shipgate ISL Verify
#
# Usage:
#   include:
#     - component: shipgate/isl-verify@v1
#       inputs:
#         path: src/
#         fail_on: error
#         mode: auto
#         config: .shipgate.yml

shipgate:
  image: ghcr.io/shipgate/shipgate:v1
  stage: test
  script:
    - |
      shipgate verify "${INPUT_PATH:-src/}" \
        --ci \
        --format gitlab \
        --fail-on "${INPUT_FAIL_ON:-error}" \
        > gl-code-quality-report.json
  artifacts:
    reports:
      codequality: gl-code-quality-report.json
    when: always
  rules:
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
    - if: '$CI_COMMIT_BRANCH'
