# ISL Implementation Rule

When implementing code that corresponds to an ISL specification (behaviors, entities, or APIs described in `.isl` files), follow this rule so implementations stay spec-compliant.

## Spec and Generated Code Locations

- **Specs**: `specs/**/*.isl`, `.shipgate/specs/*.isl`, `examples/*.isl`, `corpus/**/*.isl`, `stdlib/**/*.isl`
- **Generated TypeScript**: `examples/generated/`, `generated/ts/`, package-specific `src/generated/` (e.g. `packages/sdk-react-native/src/generated/`)
- **Config**: `.islrc.json` (spec paths, codegen targets)

## Before Writing Implementation Code

1. **Find the spec** – For the behavior/API you are implementing, locate the ISL file and the `behavior` or `entity` block that defines it.
2. **Read preconditions** – Implement only under the assumption that preconditions hold; do not duplicate precondition logic in business code (use generated wrappers when available).
3. **Read postconditions and errors** – Ensure your code establishes all postconditions on success and only throws/returns the declared error variants.

## When Writing Code

- Prefer **generated types and wrappers** (e.g. from `examples/generated/` or `generated/ts/`) over hand-written types that mirror the spec.
- If no generated code exists for this spec, run from repo root:
  - `pnpm isl:check` (or `pnpm exec isl check specs/`) to validate specs
  - `pnpm isl:gen` (or `pnpm exec isl gen ts <spec>`) to generate types/wrappers, then implement against them.
- **Error handling**: Use only the error types/codes declared in the spec's `errors` / `output.errors` block.
- **Invariants**: Do not write code that can violate any `invariant` or `invariants` block in the spec.

## After Implementation

- Run **verification** from repo root: `pnpm isl:verify` (or `pnpm exec isl verify <spec> --impl <path>`).
- If the gate is used in CI, ensure `pnpm isl:gate` (or `isl gate <spec> --impl <path>`) would pass before merging.

## Quick Reference

| Task              | Command (from repo root)                          |
|-------------------|---------------------------------------------------|
| Validate specs    | `pnpm isl:check`                                  |
| Generate TS       | `pnpm isl:gen` or `pnpm exec isl gen ts <file>`   |
| Verify impl       | `pnpm isl:verify` or `pnpm exec isl verify ...`   |
| SHIP/NO-SHIP gate | `pnpm isl:gate` or `pnpm exec isl gate ...`       |

## MCP / Tools

If the ISL MCP server is connected:
- `isl_check`, `isl_generate`, `isl_constraints`, `isl_suggest` can be used to validate, generate, and fix issues.

---
*Use this rule whenever you are implementing a feature that has (or should have) an ISL specification.*
