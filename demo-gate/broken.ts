/**
 * AI-Generated Money Transfer Implementation
 * 
 * This code was generated by an AI assistant.
 * It "looks right" but has critical bugs that would cause:
 * - Negative balances (theft)
 * - Lost money (accounting errors)
 * - Security vulnerabilities
 * 
 * The ISL Gate will catch these issues and return NO-SHIP.
 */

interface Account {
  id: string;
  owner: string;
  balance: number;
}

// In-memory store
const accounts = new Map<string, Account>();

// Initialize some test accounts
accounts.set('alice-123', { id: 'alice-123', owner: 'Alice', balance: 1000 });
accounts.set('bob-456', { id: 'bob-456', owner: 'Bob', balance: 500 });

/**
 * Transfer money between accounts
 * 
 * BUG 1: No check if sender has sufficient funds
 * BUG 2: No check if amount is positive
 * BUG 3: No check if sender and receiver are different
 */
export function transfer(
  senderId: string,
  receiverId: string,
  amount: number
): { transactionId: string; timestamp: Date } {
  const sender = accounts.get(senderId);
  const receiver = accounts.get(receiverId);

  if (!sender) {
    throw new Error('AccountNotFound: Sender not found');
  }

  if (!receiver) {
    throw new Error('AccountNotFound: Receiver not found');
  }

  // BUG: Missing validation!
  // - What if amount is negative? (steal money)
  // - What if sender.balance < amount? (negative balance)
  // - What if senderId === receiverId? (double accounting)

  // Just do the transfer (DANGEROUS!)
  sender.balance -= amount;
  receiver.balance += amount;

  // BUG: Logging the amount in plain text (security issue)
  console.log(`Transferred ${amount} from ${sender.owner} to ${receiver.owner}`);

  return {
    transactionId: crypto.randomUUID(),
    timestamp: new Date(),
  };
}

/**
 * Get account balance
 */
export function getBalance(accountId: string): number {
  const account = accounts.get(accountId);
  
  if (!account) {
    throw new Error('AccountNotFound: Account not found');
  }

  return account.balance;
}

// Demo: This would allow theft!
// transfer('alice-123', 'bob-456', 2000)  // Alice has only 1000!
// getBalance('alice-123')  // Returns -1000 (NEGATIVE!)
